@model Bill
@{
    ViewData["Title"] = "Bill Details";
}

<div class="container py-3">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2><i class="bi bi-receipt me-2"></i>Bill Details</h2>
        <a asp-action="Index" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left me-1"></i>Back to List
        </a>
    </div>

    <div class="card border mb-4">
        <div class="card-header bg-light">
            <div class="d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Bill #@Model.BillNumber</h5>
                <span class="badge @(Model.PaymentStatus == "Paid" ? "bg-success" : Model.PaymentStatus == "Pending" ? "bg-warning" : "bg-danger")">
                    @Model.PaymentStatus
                </span>
            </div>
        </div>
        <div class="card-body">
            <div class="row mb-4">
                <div class="col-md-6">
                    <h6 class="text-muted mb-3">Customer Information</h6>
                    <p><strong>Name:</strong> @Model.CustomerName</p>
                    <p><strong>Contact:</strong> @Model.CustomerContact</p>
                    <p><strong>Date:</strong> @Model.BillDate.ToString("dd MMM yyyy")</p>
                </div>
                <div class="col-md-6">
                    <h6 class="text-muted mb-3">Payment Information</h6>
                    <p><strong>Method:</strong> @Model.PaymentMethod</p>
                    <p><strong>Status:</strong> @Model.PaymentStatus</p>
                    <p><strong>Total Amount:</strong> <span class="fw-bold text-primary">‚Çπ@Model.TotalAmount.ToString("N2")</span></p>
                </div>
            </div>

            <h6 class="border-bottom pb-2 mb-3">Bill Items</h6>
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead class="table-light">
                        <tr>
                            <th>Product</th>
                            <th>Quantity</th>
                            <th>Unit Price</th>
                            <th class="text-end">Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model.BillItems)
                        {
                            <tr>
                                <td>@item.Product.Name</td>
                                <td>@item.Quantity</td>
                                <td>‚Çπ@item.UnitPrice.ToString("N2")</td>
                                <td class="text-end">‚Çπ@item.TotalPrice.ToString("N2")</td>
                            </tr>
                        }
                    </tbody>
                    <tfoot class="table-light">
                        <tr>
                            <td colspan="3" class="text-end"><strong>Total Amount:</strong></td>
                            <td class="text-end"><strong>‚Çπ@Model.TotalAmount.ToString("N2")</strong></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>

    <div class="d-flex gap-2">
        <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-primary">
            <i class="bi bi-pencil me-1"></i>Edit
        </a>
        <a asp-action="Index" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left me-1"></i>Back to List
        </a>
        <div class="ms-auto d-flex gap-2">
            <button class="btn btn-outline-success" onclick="window.print()">
                <i class="bi bi-printer me-1"></i>Print
            </button>
            <button id="whatsappShareBtn" class="btn btn-success">
                <i class="bi bi-whatsapp me-1"></i>Share via WhatsApp
            </button>
        </div>
    </div>
</div>

@section Scripts {
    <!-- Add Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    
    <style>
        @@media print {
            .btn, header, footer, nav {
                display: none !important;
            }
            .card {
                border: none !important;
            }
            .card-header {
                background-color: white !important;
                color: black !important;
            }
            body {
                padding: 0 !important;
                margin: 0 !important;
            }
            .container {
                max-width: 100% !important;
                width: 100% !important;
                padding: 0 !important;
                margin: 0 !important;
            }
        }
    </style>
    
    <script>
        document.getElementById('whatsappShareBtn').addEventListener('click', function() {
            // Create bill summary text
            let billText = "üìã *Bill Details* üìã\n\n";
            billText += "Bill #: *@Model.BillNumber*\n";
            billText += "Date: *@Model.BillDate.ToString("dd MMM yyyy")*\n";
            billText += "Customer: *@Model.CustomerName*\n";
            billText += "Status: *@Model.PaymentStatus*\n\n";
            
            billText += "üìù *Items* üìù\n";
            
            @foreach (var item in Model.BillItems)
            {
                @:billText += "‚Ä¢ @item.Product.Name √ó @item.Quantity: ‚Çπ@item.TotalPrice.ToString("N2")\n";
            }
            
            billText += "\nüí∞ *Total Amount: ‚Çπ@Model.TotalAmount.ToString("N2")* üí∞\n\n";
            billText += "Thank you for your business!";
            
            // Encode the text for URL
            let encodedText = encodeURIComponent(billText);
            
            // Create WhatsApp URL
            let whatsappUrl = "https://wa.me/?text=" + encodedText;
            
            // Open WhatsApp in a new tab
            window.open(whatsappUrl, '_blank');
        });
    </script>
}